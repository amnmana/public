{% extends 'pan_base.html' %}

{% block content %}
<div class="container">
    <div class="content">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'tripapp:mypage' %}">マイページ</a></li>
                <li class="breadcrumb-item"><a href="{% url 'tripapp:tripdetails' trip_id=trip_id %}">旅行詳細</a></li>
                <li class="breadcrumb-item active" aria-current="page">持ち物</li>
            </ol>
        </nav>
        <h1>持ち物</h1>

        <!-- アイテム追加フォーム -->
        <form id="itemsForm" method="POST" action="{% url 'tripapp:items' trip_id=trip_id %}">
            {% csrf_token %}
            <div class="form-group">
                <input type="text" name="name" placeholder="新規アイテム">
            </div>
            <div id="newItems"></div>
            <div class="button-group-centered">
                <button type="button" class="btn-flat-border" id="addNewItem" onclick="addItem()">入力欄追加</button>
            </div>
            <div class="button-group-centered">
                <button type="submit" class="btn-circle-border-double">登録</button>
                <button type="button" class="btn-circle-border-double" onclick="window.location.href='{% url 'tripapp:tripdetails' trip_id=trip_id %}'">戻る</button>
            </div>
        </form>

        <!-- アイテムリストのセクションをテーブルに変更 -->
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 5%;">チェック</th>
                    <th>アイテム</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        <form method="POST" action="{% url 'tripapp:toggle_item_checked' item.id %}">
                            {% csrf_token %}
                            <input type="checkbox" name="checked" onchange="this.form.submit()" {% if item.checked %}checked{% endif %}>
                        </form>
                    </td>
                    <td>{{ item.name }}</td>
                    <td>
                        <form method="POST" action="{% url 'tripapp:delete_item' item_id=item.id trip_id=trip_id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-flat-border btn-danger">削除</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function addItem() {
    var newItemsDiv = document.getElementById('newItems');
    var newItemDiv = document.createElement('div');
    newItemDiv.className = 'form-group new-item';
    newItemDiv.innerHTML = '<input type="text" name="name" placeholder="新規アイテム"> <button type="button" class="btn-flat-border" onclick="deleteItem(this.parentNode)">削除</button>';
    newItemsDiv.appendChild(newItemDiv);
}

function deleteItem(item) {
    // 入力フィールドを削除します
    item.parentNode.removeChild(item);
}
</script>
{% endblock %}